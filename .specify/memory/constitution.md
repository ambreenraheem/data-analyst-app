# Financial Insight & Risk Advisor Agent Constitution

<!--
Sync Impact Report:
Version change: [INITIAL] → 1.0.0
Modified principles: N/A (Initial creation)
Added sections: All core principles, Security & Compliance, Development Workflow, Governance
Removed sections: None
Templates requiring updates:
  ✅ plan-template.md - Constitution Check section will reference these principles
  ✅ spec-template.md - User scenarios align with financial analysis workflows
  ✅ tasks-template.md - Task categorization includes explainability and compliance tasks
Follow-up TODOs: None
-->

## Core Principles

### I. Data-First Financial Analysis

The agent MUST operate on structured financial data extracted from authoritative sources. All insights, anomaly detection, and risk assessments MUST be traceable to specific data points in ingested documents (PDF/Excel). No speculative analysis without data provenance.

**Non-negotiable rules**:
- Azure Document Intelligence is the primary ingestion mechanism for PDF and Excel reports
- Every extracted value MUST preserve source reference (document name, page, cell reference)
- Raw and structured data MUST be persisted for audit trail
- Data extraction failures MUST halt analysis and surface actionable errors to operators

**Rationale**: Financial decisions carry significant business risk. Traceability from insight back to source document ensures accountability and enables verification by human experts.

### II. Autonomous Reasoning with Confidence Thresholds

The agent MUST apply Azure OpenAI reasoning models to identify trends, anomalies, and risk indicators. All reasoning chains MUST be logged with confidence scores. Decisions to escalate, alert, or summarize MUST be governed by configurable confidence thresholds.

**Non-negotiable rules**:
- Every analysis produces a confidence score (0.0-1.0)
- Confidence thresholds determine action routing:
  - High confidence (≥0.85): Auto-generate CFO summary
  - Medium confidence (0.60-0.84): Flag for leadership review
  - Low confidence (<0.60): Escalate to human analyst with reasoning chain
- Reasoning chain (prompt → intermediate steps → conclusion) MUST be persisted in structured logs
- No "black box" decisions—every conclusion includes explainability artifacts

**Rationale**: Autonomous agents require guardrails. Confidence-based routing balances automation benefits with human oversight for ambiguous cases. Logging reasoning chains enables continuous improvement and debugging.

### III. Explainability and Auditability

All insights, alerts, and recommendations generated by the agent MUST include human-readable explanations and machine-readable audit trails. Compliance reviewers and business leaders MUST be able to understand why the agent reached a conclusion.

**Non-negotiable rules**:
- Every generated insight includes:
  - Natural language summary (executive-level, non-technical)
  - Supporting evidence (data points, variances, correlations)
  - Source references (document links, page numbers, cell coordinates)
  - Reasoning chain ID for deep-dive investigation
- Audit logs capture: ingestion timestamp, model version, prompt template version, output, confidence score
- Power BI integration for visual trend interpretation and drill-down
- Retention policy: minimum 7 years for financial audit logs (configurable per regulatory requirement)

**Rationale**: Regulatory compliance (SOX, GDPR, industry-specific) and internal governance demand auditability. Non-technical stakeholders (CFOs, board members) require explanations without ML jargon.

### IV. Anomaly Detection and Risk Flagging

The agent MUST actively scan for abnormal patterns, variances beyond thresholds, and correlation shifts. Detection logic MUST be configurable, testable, and versioned. False positive reduction is a continuous optimization goal.

**Non-negotiable rules**:
- Anomaly detection includes:
  - Statistical outliers (configurable sigma thresholds, e.g., 2σ, 3σ)
  - Period-over-period variance (e.g., >10% revenue drop without explanation)
  - Unexpected correlations (e.g., expense growth decoupled from revenue growth)
- Detection rules versioned and stored in code (avoid hardcoded magic numbers)
- Test suite includes known anomaly scenarios (regression prevention)
- Agent surfaces false positive feedback mechanism for continuous learning

**Rationale**: Financial risk mitigation depends on early detection. Configurable rules accommodate industry-specific thresholds. Versioning and testing prevent drift and enable reproducibility.

### V. Secure Data Handling and Access Control

Financial data is highly sensitive. The agent MUST enforce role-based access control (RBAC), encryption at rest and in transit, and least-privilege principles. Secrets (API keys, connection strings) MUST NEVER be hardcoded.

**Non-negotiable rules**:
- Authentication: Azure AD integration for all users
- Authorization: RBAC enforced at document ingestion, analysis results, and audit log access
- Encryption: TLS 1.3 for transit, Azure Storage encryption for rest
- Secrets: Azure Key Vault for API keys, connection strings, service principal credentials
- PII/PCI redaction: Automatically mask sensitive fields (SSN, credit card numbers) in logs and outputs
- Access logs: All data access events logged with user identity, timestamp, resource accessed

**Rationale**: Data breaches and unauthorized access expose organizations to legal liability and competitive harm. Defense-in-depth security aligns with enterprise standards and compliance mandates.

### VI. Human-in-the-Loop for High-Stakes Decisions

The agent is an advisor, not a decision-maker. Actions with financial impact (e.g., flagging a transaction as fraudulent, recommending budget cuts) MUST route to human reviewers. The agent provides recommendations with justification; humans approve execution.

**Non-negotiable rules**:
- No automated financial transactions or commitments
- Alerts and summaries include "Review Required" vs "Informational" classification
- Integration with approval workflows (e.g., Azure Logic Apps, Power Automate)
- Rejection feedback loop: reviewers can mark false positives/negatives to improve model

**Rationale**: Financial accountability rests with human decision-makers. The agent amplifies expert capacity but does not replace judgment.

### VII. Continuous Learning and Model Versioning

Agent reasoning quality improves over time through feedback loops and model updates. All deployed models MUST be versioned. Changes to prompts, detection rules, or reasoning templates MUST be tracked and tested before production deployment.

**Non-negotiable rules**:
- Semantic versioning for:
  - Reasoning prompt templates (e.g., `anomaly-detection-prompt-v2.1.0`)
  - Detection rule configurations (e.g., `variance-thresholds-v1.3.0`)
  - Azure OpenAI model deployments (e.g., `gpt-4-turbo-2024-04-09`)
- A/B testing for prompt changes: run old and new in parallel, compare outcomes
- Rollback capability: previous versions retained for 90 days minimum
- Change log linking prompt version to reasoning chain logs

**Rationale**: AI systems are non-deterministic and evolve. Versioning enables reproducibility, debugging, and safe iteration.

## Security & Compliance

**Regulatory Alignment**: The agent architecture MUST support compliance with:
- SOX (Sarbanes-Oxley): Audit trails, internal controls over financial reporting
- GDPR/CCPA: Data subject rights (access, deletion), consent management
- Industry-specific: FINRA, HIPAA, PCI-DSS as applicable

**Security Testing**: Regular penetration testing, vulnerability scanning, and threat modeling required before production deployment.

**Incident Response**: Documented runbook for data breach, model poisoning, or service disruption scenarios.

## Development Workflow

**Test-First for Detection Logic**: All anomaly detection rules MUST have unit tests with known-good and known-bad examples before implementation.

**Code Review Gates**:
- Security: No hardcoded secrets, RBAC enforcement verified
- Explainability: Output includes source references and reasoning chain ID
- Performance: Ingestion and analysis latency benchmarks met (e.g., <5 minutes for 100-page PDF)

**Deployment Strategy**:
- Blue-green deployment for reasoning model updates
- Feature flags for gradual rollout of new detection rules
- Monitoring dashboards (latency, error rate, confidence score distribution)

**Documentation Requirements**:
- Architecture Decision Records (ADRs) for significant choices (e.g., choice of Azure Document Intelligence vs custom OCR)
- Runbooks for common operational tasks (re-ingesting failed documents, adjusting confidence thresholds)
- User guides for business stakeholders (interpreting alerts, accessing audit logs)

## Governance

**Constitution Supersedes All**: This document defines the non-negotiable guardrails for the Financial Insight & Risk Advisor Agent. All feature specs, plans, and tasks MUST comply. Violations require explicit justification and approval.

**Amendment Process**:
1. Proposed changes documented in ADR with rationale
2. Review by technical lead and compliance/security stakeholders
3. Approval required for principles affecting security, compliance, or financial risk
4. Version bump following semantic versioning rules
5. Migration plan for features impacted by principle changes

**Compliance Verification**:
- All PRs include constitution checklist (automated linter where possible)
- Quarterly compliance audit against principles
- Metrics: audit trail coverage, secret scanning pass rate, explainability completeness

**Versioning Policy**:
- MAJOR: Principle removal or redefinition that breaks existing features
- MINOR: New principle added or expanded guidance
- PATCH: Clarifications, wording improvements, formatting fixes

**Version**: 1.0.0 | **Ratified**: 2026-01-08 | **Last Amended**: 2026-01-08
